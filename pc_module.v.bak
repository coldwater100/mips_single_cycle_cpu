//pc? ?? ??? ?? ??
module pc_module (
    input  wire        clk,
    input  wire        IsEret,       // ERET ?? ??
    input  wire        IsCOP0,       // CP0 ?? ?? ??
    input  wire [31:0] next_pc,      // ???? PC ??
    input  wire [31:0] epc,          // ?? ?? ??
    output reg  [31:0] pc_out        // ?? PC
);
    wire [63:0] mux1_in = {epc, next_pc};
    wire [31:0] after_mux1;
    wire select1 = IsEret&IsCOP0;  
    mux #(.select_bit(1), .data_bits(32)) mux1 (
        .sel(select1),
        .data_in(mux1_in),
        .data_out(after_mux1)
    );

    wire [31:0] exp_addr = 32'h00000800;
    wire [63:0] mux2_in = {exp_addr, after_mux1};
    wire [31:0] after_mux2;
    wire [31:0] not_HasExp = ~HasExp;
    mux #(.select_bit(1), .data_bits(32)) mux2 (
        .sel(not_HasExp),
        .data_in(mux2_in),
        .data_out(after_mux2)
    );

    wire gated_clk;
    mux #(.select_bit(1), .data_bits(32)) clk_mux (
        .sel(select1|HasExp),
        .data_in({~clk,clk}),
        .data_out(gated_clk)
    );

    // PC ???? ??
    always @(posedge gated_clk) begin
        pc_out <= after_mux2;
    end

endmodule
